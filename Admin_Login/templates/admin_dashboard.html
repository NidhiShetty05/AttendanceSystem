<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    background-color: #f5f7f4;
    background-image: url("{{ url_for('static', filename='innerheadercommon.jpg') }}");
    background-repeat: no-repeat;
    background-position: top center;
    background-size: contain;
}

.wrapper {
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding-top: 60px;
}

.dashboard {
    width: 420px;
    background: white;
    border-radius: 14px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    padding: 30px;
}

.section {
    display: none;
}

h2 {
    text-align: center;
    color: #004a99;
    margin-bottom: 20px;
}

.btn {
    width: 100%;
    padding: 14px;
    margin-top: 12px;
    border: none;
    border-radius: 8px;
    background: #004a99;
    color: white;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
}

.btn:hover { background: #003366; }

.back { background: #666; }

label {
    margin-top: 10px;
    display: block;
    font-weight: bold;
}

input, select {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    border-radius: 6px;
    border: 1px solid #ccc;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th {
    background: #004a99;
    color: white;
    padding: 8px;
}

td {
    padding: 8px;
    text-align: center;
}
</style>
</head>

<body>

<div class="wrapper">
<div class="dashboard">
<img src="{{ url_for('static', filename='sieslogo.jpg') }}" alt="Logo">

<!-- MAIN MENU -->
<div id="mainMenu">
    <h2>Welcome Admin</h2>
    <button class="btn" onclick="showTeacherMenu()">Teacher Management</button>
    <button class="btn" onclick="showStudentMenu()">Student Management</button>
</div>

<!-- TEACHER MENU -->
<div id="teacherMenu" class="section">
    <h2>Teacher Management</h2>
    <button class="btn" onclick="showAddTeacher()">Add Teacher</button>
    <button class="btn" onclick="showViewTeacher()">View Teachers</button>
    <button class="btn" onclick="showDeleteTeacher()">Delete Teacher</button>
    <button class="btn" onclick="showAssignSubject()">Assign Subject</button>
    <button class="btn back" onclick="goBack()">Back</button>
</div>

<!-- STUDENT MENU -->
<div id="studentMenu" class="section">
    <h2>Student Management</h2>
    <button class="btn" onclick="showAddStudent()">Add Student</button>
    <button class="btn" onclick="showViewStudent()">View Students</button>
    <button class="btn" onclick="showDeleteStudent()">Delete Student</button>
    <button class="btn back" onclick="goBack()">Back</button>
</div>

<!-- ADD TEACHER -->
<div id="addTeacher" class="section">
    <h2>Add Teacher</h2>
    <label>Name</label><input id="tname">
    <label>Department</label>
    <select id="tdept"><option value="">Select Department</option><option>CS</option><option>IT</option></select>
    <label>Teacher ID</label><input id="tid">
    <label>Password</label><input type="password" id="tpass">
    <button class="btn" onclick="saveTeacher()">Save</button>
    <button class="btn back" onclick="goBack()">Back</button>
</div>

<!-- VIEW TEACHERS -->
<div id="viewTeacher" class="section">
    <h2>Teachers</h2>
    <table>
        <thead><tr><th>Name</th><th>Dept</th><th>ID</th></tr></thead>
        <tbody id="teacherTable"></tbody>
    </table>
    <button class="btn back" onclick="goBack()">Back</button>
</div>

<!-- DELETE TEACHER -->
<div id="deleteTeacher" class="section">
    <h2>Delete Teacher</h2>
    <select id="deleteList"></select>
    <button class="btn" onclick="deleteTeacherData()">Delete</button>
    <button class="btn back" onclick="goBack()">Back</button>
</div>
<!-- ASSIGN SUBJECT -->
<!-- ASSIGN SUBJECT -->
<div id="assignSubject" class="section">
    <h2>Assign Subject</h2>

    <label>Teacher</label>
    <select id="as_teacher"></select>

    <label>Stream</label>
    <select id="as_stream">
        <option value="">Select</option>
        <option value="IT">IT</option>
        <option value="CS">CS</option>
    </select>

    <label>Year</label>
    <select id="as_year">
        <option value="">Select</option>
        <option value="1">First Year</option>
        <option value="2">Second Year</option>
        <option value="3">Third Year</option>
    </select>

    <label>Semester</label>
    <select id="as_semester">
        <option value="">Select</option>
        <option value="1">Sem 1</option>
        <option value="2">Sem 2</option>
        <option value="3">Sem 3</option>
        <option value="4">Sem 4</option>
        <option value="5">Sem 5</option>
        <option value="6">Sem 6</option>
    </select>

    <label>Subject</label>
    <select id="as_subject"></select>

    <button class="btn" onclick="assignSubject()">Assign</button>
    <button class="btn back" onclick="goBack()">Back</button>
</div>



<!-- ADD STUDENT -->
<div id="addStudent" class="section">
    <h2>Add Student</h2>
    <label>Student Name</label>
    <input id="sname">
    <label>Department</label>
    <select id="sdept"><option value="">Select Department</option><option>CS</option><option>IT</option></select>
    <label>Year</label>
    <select id="syear"><option value="">Select Year</option><option>1</option><option>2</option><option>3</option><option>4</option></select>
    <label>Roll No</label><input id="sroll">
    <label>Password</label><input type="password" id="spass">
    <button class="btn" onclick="saveStudent()">Save</button>
    <button class="btn back" onclick="goBack()">Back</button>
</div>

<!-- VIEW STUDENTS -->
<div id="viewStudent" class="section">
    <h2>Students</h2>
    <table>
        <thead><tr><th>Dept</th><th>Year</th><th>Roll</th></tr></thead>
        <tbody id="studentTable"></tbody>
    </table>
    <button class="btn back" onclick="goBack()">Back</button>
</div>

<!-- DELETE STUDENT -->
<div id="deleteStudent" class="section">
    <h2>Delete Student</h2>
    <select id="deleteStudentList"></select>
    <button class="btn" onclick="deleteStudentData()">Delete</button>
    <button class="btn back" onclick="goBack()">Back</button>
</div>

</div>
</div>

<script>
const $ = id => document.getElementById(id);

function hideAll(){
    ["mainMenu","teacherMenu","studentMenu","addTeacher","viewTeacher","deleteTeacher","addStudent","viewStudent","deleteStudent", "assignSubject"]
    .forEach(id => $(id).style.display="none");
}

function goBack(){ hideAll(); $("mainMenu").style.display="block"; }
function showTeacherMenu(){ hideAll(); $("teacherMenu").style.display="block"; }
function showStudentMenu(){ hideAll(); $("studentMenu").style.display="block"; }

function showAddTeacher(){ hideAll(); $("addTeacher").style.display="block"; }
function showViewTeacher(){ hideAll(); $("viewTeacher").style.display="block"; loadTeachers(); }
function showDeleteTeacher(){ hideAll(); $("deleteTeacher").style.display="block"; loadTeacherDelete(); }

function showAddStudent(){ hideAll(); $("addStudent").style.display="block"; }
function showViewStudent(){ hideAll(); $("viewStudent").style.display="block"; loadStudents(); }
function showDeleteStudent(){ hideAll(); $("deleteStudent").style.display="block"; loadStudentDelete(); }

function saveTeacher(){
fetch("/add_teacher",{method:"POST",headers:{"Content-Type":"application/json"},
body:JSON.stringify({name:tname.value,department:tdept.value,teacher_id:tid.value,password:tpass.value})})
.then(r=>r.json()).then(d=>alert(d.message));
}

function loadTeachers(){
fetch("/get_teachers").then(r=>r.json()).then(d=>{
teacherTable.innerHTML="";
d.forEach(t=>teacherTable.innerHTML+=`<tr><td>${t.name}</td><td>${t.department}</td><td>${t.teacher_id}</td></tr>`);
});
}

function loadTeacherDelete(){
fetch("/get_teachers").then(r=>r.json()).then(d=>{
deleteList.innerHTML="";
d.forEach(t=>deleteList.innerHTML+=`<option value="${t.teacher_id}">${t.name}</option>`);
});
}

function deleteTeacherData(){
fetch("/delete_teacher",{method:"POST",headers:{"Content-Type":"application/json"},
body:JSON.stringify({teacher_id:deleteList.value})})
.then(r=>r.json()).then(d=>alert(d.message));
}

function showAssignSubject(){
    hideAll();
    $("assignSubject").style.display = "block";
    loadAssignTeachers();
}

/* Load teachers */
function loadAssignTeachers(){
    fetch("/api/teachers")
    .then(r => r.json())
    .then(data => {
        as_teacher.innerHTML = '<option value="">Select Teacher</option>';
        data.forEach(t => {
            as_teacher.innerHTML += `
                <option value="${t.teacher_id}">
                    ${t.teacher_name} (${t.teacher_id})
                </option>`;
        });
    });
}

/* Load subjects */
function loadAssignSubjects(){
    if(!as_stream.value || !as_year.value || !as_semester.value) return;

    fetch(`/api/subjects?stream=${as_stream.value}&year=${as_year.value}&semester=${as_semester.value}`)
    .then(r => r.json())
    .then(data => {
        as_subject.innerHTML = '<option value="">Select Subject</option>';
        data.forEach(s => {
            as_subject.innerHTML += `<option value="${s.id}">${s.subject_name}</option>`;
        });
    });
}

as_stream.onchange = loadAssignSubjects;
as_year.onchange = loadAssignSubjects;
as_semester.onchange = loadAssignSubjects;

/* Assign subject */
function assignSubject(){
    if(!as_teacher.value || !as_subject.value){
        alert("Please select all fields");
        return;
    }

    fetch("/api/assign-subject",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            teacher_id: as_teacher.value,
            subject_id: as_subject.value,
            stream: as_stream.value,
            year: as_year.value,
            semester: as_semester.value
        })
    })
    .then(r=>r.json())
    .then(d=>alert(d.message));
}

function saveStudent(){
fetch("/add_student",{method:"POST",headers:{"Content-Type":"application/json"},
body: JSON.stringify({
    name: sname.value,
    department: sdept.value,
    year: syear.value,
    roll_no: sroll.value,
    password: spass.value
})
})
.then(r=>r.json()).then(d=>alert(d.message));
}

function loadStudents(){
fetch("/get_students").then(r=>r.json()).then(d=>{
studentTable.innerHTML="";
d.forEach(s=>studentTable.innerHTML+=`<tr><td>${s.department}</td><td>${s.year}</td><td>${s.roll_no}</td></tr>`);
});
}

function loadStudentDelete(){
fetch("/get_students").then(r=>r.json()).then(d=>{
deleteStudentList.innerHTML="";
d.forEach(s=>deleteStudentList.innerHTML+=`<option value="${s.roll_no}">${s.roll_no}</option>`);
});
}

function deleteStudentData(){
fetch("/delete_student",{method:"POST",headers:{"Content-Type":"application/json"},
body:JSON.stringify({roll_no:deleteStudentList.value})})
.then(r=>r.json()).then(d=>alert(d.message));
}

hideAll(); $("mainMenu").style.display="block";
</script>

</body>
</html>